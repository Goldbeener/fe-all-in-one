`visibilitychange` 主要强调页面是否被用户可见, **用户视角**
1. 切换tab
2. 浏览器最小化
3. 切换窗口
4. 锁屏/熄屏
5. 页面被覆盖

用途
1. 进入后台就暂停任务



`pageshow/pagehide` 页面进入/离开浏览器的页面生命周期， **浏览器生命周期视角**
1. 页面离开/回到当前浏览器上下文
2. 前进/后退，跳转到新页面
3. BFCache 进入/恢复

附带页面是否被缓存： `event.persisted`

visibilityChange 表示页面的可见性发生了变化，不会引起URL的变化，也不涉及浏览器的导航行为；页面的JS与DOM仍然存在，只是暂时对用户不可见。 `Page Visibility API`

pageshow/pagehide 表示页面在浏览器生命周期中进入或离开，通常与导航行为有关。但在BFCache或webView栈恢复的场景下，URL可能只是被恢复，页面不会重新初始化，JS状态被完整保留。`Page Lifecycle API`


页面卸载
1. 页面可见时，用户关闭tab或浏览器窗口
2. 页面可见时，用户在当前页面前往另一个页面
3. 页面不可见时，用户或系统关闭浏览器窗口

这三种情况都会触发visibilityChange事件



`beforeunload`  事件在窗口或文档即将卸载时触发，
事件发生时，文档仍然可见，此时卸载仍可取消
通常用于提示用户


```js
let hasRefreshedOnShow = false;

function refreshData() {
  console.log('refresh data');
  // 真正的请求逻辑
}

/**
 * 1️⃣ 页面进入（首次 or 栈恢复）
 */
window.addEventListener('pageshow', (event) => {
  hasRefreshedOnShow = true;
  refreshData();
});

/**
 * 2️⃣ 页面从不可见 → 可见
 */
document.addEventListener('visibilitychange', () => {
  if (
    document.visibilityState === 'visible' &&
    !hasRefreshedOnShow
  ) {
    refreshData();
  }
  hasRefreshedOnShow = false;
});

// 3️⃣. JS 冻结恢复（增强/可选）
document.addEventListener('resume', () => {
  refresh('resume');
});
```

对于SPA页面，通常也不在`pageshow`回调内触发刷新，
一般在SPA组件生命周期内做第一次刷新，
然后再监听`pageshow` 和 `visibilityChange`事件，做后续的进入刷新

可以加上resume做增强的补充

